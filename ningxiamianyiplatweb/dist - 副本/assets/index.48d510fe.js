import{m as e}from"./index.143fdacc.js";import{y as a,z as l,A as t,B as o}from"./setting.2fd48f52.js";import{j as d,r as i,S as n,b as u,c as r,d as s,w as m,k as c,u as p,U as v,f,l as g,Y as b,e as y,A as h,a1 as V}from"./vendor.cc783c3b.js";const w={__name:"dialogInfo",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},id:{type:String,default:""}},emits:["close"],setup(t,{emit:o}){const y=t,h=e(),{appContext:V}=b(),w=V.config.globalProperties;let x=d({areaCode:"",selectAreaLevel:sessionStorage.getItem("currentLevel")});const T=e=>{x=e},C=i({organName:"",theme:"",content:"",complainTime:w.$dateUtil.currentDate(),userName:""}),N=e=>e.getTime()>Date.now(),k=i(null),_=d({theme:[{required:!0,message:"投诉主题必填且不能为空！",trigger:"blur"}],content:[{required:!0,message:"投诉内容必填且不能为空！",trigger:"blur"}]});n((()=>y.visible),(e=>{if(e)if(y.isEdit){const e={id:y.id};a(e).then((e=>{200===e.data.code&&(C.value=e.data.data.data)}))}else C.value={organName:"",theme:"",content:"",complainTime:w.$dateUtil.currentDate(),userName:""}}),{deep:!0,immediate:!0});const D=()=>{o("close",!0)};return(e,a)=>{const o=u("ss-area-areaTreeStation"),d=u("el-input"),i=u("el-form-item"),n=u("el-date-picker"),b=u("el-button"),y=u("el-form"),V=u("el-dialog");return r(),s(V,{title:t.isEdit?"投诉管理编辑":"投诉管理新增",modelValue:t.visible,"onUpdate:modelValue":a[7]||(a[7]=e=>v(visible)?visible.value=e:null),width:"1000","before-close":D,"close-on-click-modal":!1,class:"customDialog","append-to-body":!0,style:{"max-height":"700px","overflow-y":"auto"}},{default:m((()=>[c(y,{ref_key:"ruleFormRef",ref:k,rules:_,model:C.value,"label-width":"120px"},{default:m((()=>[c(i,{label:"被投诉单位：",required:"","label-width":"200"},{default:m((()=>[t.isEdit?(r(),s(d,{key:1,modelValue:C.value.organName,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.organName=e),maxlength:"50",readonly:"true"},null,8,["modelValue"])):(r(),s(o,{key:0,modelValue:p(x),"onUpdate:modelValue":a[0]||(a[0]=e=>v(x)?x.value=e:x=e),getToLevelNum:5,onNodeClick:T,clearable:""},null,8,["modelValue"]))])),_:1}),c(i,{label:"投诉主题：",prop:"theme",required:"","label-width":"200"},{default:m((()=>[c(d,{modelValue:C.value.theme,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value.theme=e),maxlength:"50",readonly:!!t.isEdit},null,8,["modelValue","readonly"])])),_:1}),c(i,{label:"投诉内容：",prop:"content","label-width":"200"},{default:m((()=>[c(d,{modelValue:C.value.content,"onUpdate:modelValue":a[3]||(a[3]=e=>C.value.content=e),maxlength:"500","show-word-limit":"",rows:"6",type:"textarea",readonly:!!t.isEdit},null,8,["modelValue","readonly"])])),_:1}),c(i,{label:"投诉日期：",prop:"complainTime","label-width":"200"},{default:m((()=>[c(n,{modelValue:C.value.complainTime,"onUpdate:modelValue":a[4]||(a[4]=e=>C.value.complainTime=e),type:"date","disabled-date":N,readonly:!!t.isEdit},null,8,["modelValue","readonly"])])),_:1}),t.isEdit?(r(),s(i,{key:0,label:"记录人员：",prop:"userId","label-width":"200"},{default:m((()=>[c(d,{modelValue:C.value.userName,"onUpdate:modelValue":a[5]||(a[5]=e=>C.value.userName=e),maxlength:"50",readonly:!!t.isEdit},null,8,["modelValue","readonly"])])),_:1})):f("",!0),c(i,{"label-width":"200",class:"dialog-footer"},{default:m((()=>[t.isEdit?(r(),s(b,{key:0,onClick:D},{default:m((()=>[g("关 闭")])),_:1})):f("",!0),t.isEdit?f("",!0):(r(),s(b,{key:1,type:"primary",onClick:a[6]||(a[6]=e=>{k.value.validate(((e,a)=>{if(e){if("4"!=x.selectAreaLevel)return w.$util.showMsg("请选择接种单位！","error");const e={userId:h.userInfo.id,areaCode:h.userInfo.areaCode,organCode:x.areaCode,theme:C.value.theme,content:C.value.content,time:C.value.complainTime};l(e).then((e=>200===e.data.code?(D(),w.$util.showMsg(e.data.data.data||"新增成功！","success")):(D(),w.$util.showMsg(e.data.data.popMsg||"新增失败！","error"))))}}))})},{default:m((()=>[g("保 存")])),_:1})),t.isEdit?f("",!0):(r(),s(b,{key:2,onClick:D},{default:m((()=>[g("取 消")])),_:1}))])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"])}}},x={class:"flex"},T={class:"flex"},C=h("span",{class:"mr10 label"},"归属地区：",-1),N={class:"flex ml20"},k=h("span",{class:"mr10 label"},"投诉时间范围：",-1),_={class:"mt10"},D={__name:"index",setup(a){const l=e(),{appContext:n}=b(),s=n.config.globalProperties,f=i([s.$dateUtil.currentMonth("YYYY-MM-DD"),s.$dateUtil.dayAddNum(0)]),g=i([]),D=i(0),E=i(1),U=d([{label:"序号",prop:"rowNum"},{label:"操作",type:"operation",btns:[{type:"primary",text:"查看",event:"see"},{type:"danger",text:"删除",event:"delete"}]},{label:"被投诉单位",prop:"organName"},{label:"投诉日期",prop:"complainTime"},{label:"投诉主题",prop:"theme"},{label:"记录人员",prop:"userName"}]),L=i(!1),M=i(""),S=i(!1);let $=d({areaCode:l.userInfo.areaCode,selectAreaLevel:sessionStorage.getItem("currentLevel")});const I=e=>{"number"==typeof e&&(E.value=e);const a={areaLevel:$.selectAreaLevel,areaCode:$.areaCode,complainStartTime:f.value[0],complainEndTime:f.value[1],pageNum:E.value};t(a).then((e=>{200===e.data.code&&(g.value=e.data.data.data.list,D.value=e.data.data.data.total)}))},A=()=>{M.value="",S.value=!1,L.value=!0},q=(e,a)=>{"see"==a&&(e=>{M.value=e.id,S.value=!0,L.value=!0})(e),"delete"==a&&(e=>{V.confirm("请问是否确认删除?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"danger"}).then((()=>{const a={id:e.id};o(a).then((e=>{if(200===e.data.code)return I(),s.$util.showMsg(e.data.data.data||"删除成功！","success")}))})).catch((()=>s.$util.showMsg("取消删除！","info")))})(e)},B=()=>{L.value=!1},Y=e=>{$=e};return(e,a)=>{const l=u("ss-area-areaTreeStation"),t=u("ss-date-range-new"),o=u("ss-custom-button"),d=u("ss-condition-area"),i=u("ss-custom-table");return r(),y("div",null,[c(d,null,{default:m((()=>[h("div",x,[h("div",T,[C,c(l,{ref:"areaTreeStation",modelValue:p($),"onUpdate:modelValue":a[0]||(a[0]=e=>v($)?$.value=e:$=e),getToLevelNum:5,showSelect:!1,onNodeClick:Y},null,8,["modelValue"])]),h("div",N,[k,c(t,{defaultValue:f.value,"onUpdate:defaultValue":a[1]||(a[1]=e=>f.value=e),rangeName:"year"},null,8,["defaultValue"])])]),h("div",_,[c(o,{type:"insert",onClick:A}),c(o,{type:"query",onClick:I})])])),_:1}),c(i,{tableData:g.value,columnList:U,onOpenDetailDialog:e.openDetailDialog,total:0,onRowOperateFun:q},null,8,["tableData","columnList","onOpenDetailDialog"]),c(w,{visible:L.value,onClose:B,areaTreeValue:e.areaTreeData,id:M.value,isEdit:S.value},null,8,["visible","areaTreeValue","id","isEdit"])])}}};export{D as default};
