import{r as e,S as l,a0 as a,b as t,c as d,d as u,w as o,k as r,A as n,l as i,a7 as s,Y as p,j as c,o as f,e as h,u as m,I as v,J as b,a5 as y,f as g,D as C,F as U,n as N,a1 as E}from"./vendor.cc783c3b.js";import{s as _,t as x,v as O,w as k,x as D}from"./setting.2fd48f52.js";import{_ as S,m as V}from"./index.143fdacc.js";const w={class:"card-header"},I={class:"center-btn-con"},P={class:"card-header"},T={__name:"treeTransfer",props:{leftCardName:{type:String,required:!1,default:"未授权模块"},rightCardName:{type:String,required:!1,default:"已授权模块"},treeData:{type:Array,default:()=>[]},defaultProps:{type:Object,default:()=>({id:"id",children:"children",label:"name"})},defValue:{type:Array,default:()=>[]},keyCode:{type:String,default:"id"},shadow:{type:String,default:"never"}},emits:["callabck"],setup(p,{emit:c}){const f=p,h=e(!1),m=e(!1),v=e(),b=e(),y=e([]),g=e([]),C=e(!0),U=e(!0),N=1,E=2,_=3,x=4;l([()=>{f.treeData}],(()=>{M()}),{deep:!0}),l((()=>{f.defValue}),(()=>{K()}),{deep:!0});const O=e=>{switch(e){case E:case N:let l=null,t=null;e==N?(l=v,t=b):(l=b,t=v);let d=l.value.root.childNodes;const u=b.value.getCheckedKeys();let o=V(d,[],e);a((()=>{e==E&&u.forEach((e=>{const l=b.value.getNode(e);S(l)}))})),T(t.value.root.childNodes,o,e);break;case x:g.value=[],y.value=[],a((()=>{M(),K()}))}m.value=!1,h.value=!1,a((()=>{setTimeout((()=>{c("callabck",D(b.value.root.childNodes,[]),k(b.value.root.childNodes,[]))}),1e3)}))},k=(e,l)=>(e.forEach((e=>{e.isLeaf&&e.visible&&l.push(e.data[f.keyCode]),e.childNodes.length&&e.visible&&k(e.childNodes,l)})),l),D=(e,l)=>(e.forEach((e=>{e.isLeaf&&e.visible&&l.push(s(e.data)),e.childNodes.length&&e.visible&&D(e.childNodes,l)})),l),S=e=>{const l=e.parent.childNodes;let a=!1;for(let t=0;t<l.length;t++)if(l[t].visible){a=!0;break}a||(e.parent.visible=!1,e.parent.parent&&0!=e.parent.parent.level&&S(e.parent))},V=(e,l,a)=>(e.filter((e=>((e.checked||e.indeterminate)&&l.push(e.data[f.keyCode]),e.checked||e.indeterminate))).forEach((e=>(e.checked?e.visible=!1:e.visible=!0,a!=_&&(e.indeterminate=!1),e.childNodes&&(e.children=V(e.childNodes,l,a))))),l),T=(e,l,a)=>{e.forEach((e=>{l.indexOf(e.data[f.keyCode])>-1?(e.visible=!0,e.checked=!1):a==_&&(e.visible=!1,e.checked=!0),e.childNodes&&e.childNodes.length&&T(e.childNodes,l,a)}))},q=(e,l,a)=>{let t=R(b),d=R(v);C.value=!d.length,U.value=!t.length},R=e=>{let l=e.value.getCheckedKeys();for(let a=0;a<l.length;a++){e.value.getNode(l[a]).visible||(l.splice(a,1),a--)}return l},K=()=>{v.value.setCheckedKeys(f.defValue,!1),a((()=>{let e=V(v.value.root.childNodes,[],N);T(b.value.root.childNodes,e,_)}))},M=()=>{g.value=f.treeData,y.value=f.treeData},A=e=>{switch(e){case"left":h.value?j(v.value,g.value):j(v.value,g.value,[]);break;case"right":m.value?j(b.value,y.value):j(b.value,y.value,[])}},j=(e,l,a)=>{a||(a=[],l.forEach((e=>{a.push(e.id)}))),e.setCheckedKeys(a)};return(e,l)=>{const a=t("el-checkbox"),s=t("el-tree"),c=t("el-scrollbar"),_=t("el-card"),x=t("el-col"),k=t("ss-common-icon"),D=t("el-button"),S=t("el-row");return d(),u(S,{gutter:20},{default:o((()=>[r(x,{span:10},{default:o((()=>[r(_,{class:"tree-transfer-card",shadow:p.shadow},{header:o((()=>[n("div",w,[r(a,{modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value=e),label:p.leftCardName,size:"large",onChange:l[1]||(l[1]=e=>A("left"))},null,8,["modelValue","label"])])])),default:o((()=>[r(c,{height:"240px"},{default:o((()=>[r(s,{ref_key:"leftTreeRef",ref:v,data:g.value,"show-checkbox":"","default-expand-all":"","node-key":"id",onCheckChange:q,"highlight-current":"",props:f.defaultProps},null,8,["data","props"])])),_:1})])),_:1},8,["shadow"])])),_:1}),r(x,{span:4},{default:o((()=>[n("div",I,[r(D,{type:"primary",style:{"margin-left":"10px"},onClick:l[2]||(l[2]=e=>O(N)),disabled:C.value},{default:o((()=>[i(" 到右边"),r(k,{elIcon:"ArrowRight"})])),_:1},8,["disabled"]),r(D,{type:"primary",onClick:l[3]||(l[3]=e=>O(E)),disabled:U.value},{default:o((()=>[r(k,{elIcon:"ArrowLeft"}),i("到左边 ")])),_:1},8,["disabled"])])])),_:1}),r(x,{span:10},{default:o((()=>[r(_,{class:"tree-transfer-card"},{header:o((()=>[n("div",P,[r(a,{modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=e=>m.value=e),label:p.rightCardName,size:"large",onChange:l[5]||(l[5]=e=>A("right"))},null,8,["modelValue","label"])])])),default:o((()=>[r(c,{height:"240px"},{default:o((()=>[r(s,{ref_key:"rightTreeRef",ref:b,data:y.value,"show-checkbox":"","default-expand-all":"","node-key":"id",onCheckChange:q,"highlight-current":"",props:f.defaultProps},null,8,["data","props"])])),_:1})])),_:1})])),_:1})])),_:1})}}};const q=e=>(C("data-v-2a6ef776"),e=e(),U(),e),R={class:"rolesManage"},K={class:"flex flex-top"},M={class:"item"},A=q((()=>n("div",{class:"label"},"选择角色：",-1))),j={class:"module-area"},Q={class:"op-area"},L=q((()=>n("div",{class:"left"},"角色模块权限",-1))),Y={class:"right"};var G=S({__name:"index",setup(l){const s=V(),{appContext:C}=p(),U=C.config.globalProperties;let S=[];const w=e(null),I=e(0),P=e([]),q=e([]),G=e([]),J=e([]),$=e([]),z=e(null);let B=e({id:null,roleCode:"",roleName:"",roleExplain:"",onOff:"1",moduleids:""});const F=c({roleCode:[{required:!0,trigger:"blur",validator:(e,l,a)=>{l?l.length>20&&a("角色编码最多20位字符，请重新填写。"):a("角色编码项为必输项，请填写完整再保存。"),a()}}],roleName:[{required:!0,trigger:"blur",validator:(e,l,a)=>{l?l.length>20&&a("角色名称最多20位字符，请重新填写。"):a("角色名称为必输项，请填写完整再保存。"),a()}}]}),H=e=>{e.target.value=e.target.value.replace(/\s+/g,"")},W=e=>{w.value.setheight()},X=()=>{B.value.moduleList=J.value,"1"===I.value?z.value.validate().then((e=>{if(e){if(!B.value.moduleids||""==B.value.moduleids)return N.error("请为角色分配模块权限！"),!1;B.value.cModId=s.moduleId,B.value.operateType=U.$consts.OPTYPE_UPDATE,O(B.value).then((()=>{N.success("修改成功！"),ae()}))}})):z.value.validate().then((e=>{if(e){if(!B.value.moduleids||""==B.value.moduleids)return N.error("请为角色分配模块权限！"),!1;B.value.cModId=s.moduleId,B.value.operateType=U.$consts.OPTYPE_INSERT,k(B.value).then((()=>{N.success("新增成功！"),ae(),te()}))}}))},Z=()=>{if(!B.value.id||""==B.value.id)return N.error("请选择要删除的角色！"),!1;E.confirm("请问是否确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e={id:B.value.id,cModId:s.moduleId,operateType:U.$consts.OPTYPE_DELETE};D(e).then((e=>{N.success("删除成功！"),ae(),te()}))})).catch((e=>{N.info("已取消删除")}))},ee=()=>{J.value.forEach((e=>{e.canInsert&&(e.insert=!0),e.canUpdate&&(e.update=!0),e.canDelete&&(e.delete=!0),e.canOutput&&(e.output=!0)}))},le=()=>{J.value.forEach((e=>{e.canInsert&&(e.insert=!1),e.canUpdate&&(e.update=!1),e.canDelete&&(e.delete=!1),e.canOutput&&(e.output=!1)}))},ae=()=>{_().then((e=>{P.value=e.data.data||[]}))},te=()=>{B.value={id:null,roleCode:"",roleName:"",roleExplain:"",onOff:"1",moduleids:""},I.value="0",q.value=[],a((()=>{q.value=S,G.value=[]})),J.value=[],$.value=[]},de=e=>{e?(I.value="1",x({id:e}).then((e=>{if(e){B.value=e.data.data.roleInfo,$.value=e.data.data.selModuleList;let l=[];$.value.forEach((e=>{e.pid=e.supId,l.push(e.id)})),ue("",l),B.value.moduleids=l.join(","),G.value=l}})).catch((()=>{}))):te()},ue=(e,l)=>{(e=>{let l=[];e.forEach((e=>{e.children&&e.children.length>0&&e.children.forEach((e=>{if(!e.leaf&&e.children&&e.children.length>0)e.children.forEach((e=>{let a=!0,t=e,d={id:t.id,name:t.name,code:t.code,canQuery:t.canQuery,canPrint:t.canPrint,canInsert:t.canInsert,canUpdate:t.canUpdate,canDelete:t.canDelete,canOutput:t.canOutput};for(let u=0;u<$.value.length;u++)if($.value[u].id==e.id){d.query=$.value[u].query,d.print=$.value[u].print,d.insert=$.value[u].insert,d.update=$.value[u].update,d.delete=$.value[u].delete,d.output=$.value[u].output,l.push(d),a=!1;break}a&&(d.query=!1,d.print=!1,d.insert=!1,d.update=!1,d.delete=!1,d.output=!1,d.canQuery&&(d.query=!0),d.canPrint&&(d.print=!0),d.canInsert&&(d.insert=!0),d.canUpdate&&(d.update=!0),d.canDelete&&(d.delete=!0),d.canOutput&&(d.output=!0),l.push(d))}));else{let a={};"1"==I.value||0!=$.value.length||a.id&&""!=a.id||(a=e,a.query=!1,a.print=!1,a.insert=!1,a.update=!1,a.delete=!1,a.output=!1,a.canQuery&&(a.query=!0),a.canPrint&&(a.print=!0),a.canInsert&&(a.insert=!0),a.canUpdate&&(a.update=!0),a.canDelete&&(a.delete=!0),a.canOutput&&(a.output=!0),l.push(a));let t=!1;for(let d=0;d<$.value.length;d++){t=!0;let u=e;if(a={id:u.id,name:u.name,code:u.code,canQuery:u.canQuery,canPrint:u.canPrint,canInsert:u.canInsert,canUpdate:u.canUpdate,canDelete:u.canDelete,canOutput:u.canOutput},$.value[d].id==e.id){a.query=$.value[d].query,a.print=$.value[d].print,a.insert=$.value[d].insert,a.update=$.value[d].update,a.delete=$.value[d].delete,a.output=$.value[d].output,l.push(a),t=!1;break}}t&&(a.query=!1,a.print=!1,a.insert=!1,a.update=!1,a.delete=!1,a.output=!1,a.canQuery&&(a.query=!0),a.canPrint&&(a.print=!0),a.canInsert&&(a.insert=!0),a.canUpdate&&(a.update=!0),a.canDelete&&(a.delete=!0),a.canOutput&&(a.output=!0),l.push(a))}}))})),J.value=l})(oe(S,l)),B.value.moduleids=l.join(",")},oe=(e,l)=>{if(!e||!l)return[];let a=l;return JSON.parse(JSON.stringify(e)).filter((e=>e.children&&e.children.length>0?(e.children=e.children.filter((e=>e.children&&e.children.length>0?(e.children=e.children.filter((e=>a.some((l=>l==e.id)))),e.children.length>0):a.some((l=>l==e.id)))),e.children.length>0):a.some((l=>l==e.id))))};return f((()=>{ae(),(()=>{let e=[{id:"38",roleCode:"030801",roleName:"030801",roleExplain:"030801",onOff:"1",updateDate:"2023-03-08 14:04:19",updateUser:"超级管理员",tableStatus:null},{id:"9",roleCode:"0922002",roleName:"0922002",roleExplain:"22222",onOff:"1",updateDate:"2021-09-22 09:57:01",updateUser:"超级管理员1",tableStatus:null},{id:"18",roleCode:"1103",roleName:"角色名称",roleExplain:"描述信息",onOff:"0",updateDate:"2021-11-08 16:27:13",updateUser:"超级管理员1",tableStatus:null},{id:"23",roleCode:"1108",roleName:"1108",roleExplain:null,onOff:"1",updateDate:"2021-11-08 16:22:32",updateUser:"超级管理员1",tableStatus:null},{id:"26",roleCode:"1108-2",roleName:"1108-2",roleExplain:null,onOff:"1",updateDate:"2021-11-08 16:24:45",updateUser:"超级管理员1",tableStatus:null},{id:"24",roleCode:"110801",roleName:"110801",roleExplain:null,onOff:"1",updateDate:"2021-11-08 16:16:43",updateUser:"超级管理员1",tableStatus:null},{id:"29",roleCode:"1111-01",roleName:"1111-01",roleExplain:"1",onOff:"1",updateDate:"2021-11-11 10:36:58",updateUser:"超级管理员1",tableStatus:null},{id:"39",roleCode:"11122",roleName:"11122",roleExplain:null,onOff:"1",updateDate:"2023-03-08 15:03:07",updateUser:"超级管理员1",tableStatus:null},{id:"30",roleCode:"1116-1",roleName:"1116-1",roleExplain:null,onOff:"1",updateDate:"2021-11-16 09:34:51",updateUser:"超级管理员1",tableStatus:null},{id:"35",roleCode:"1119-1",roleName:"1119-1",roleExplain:null,onOff:"0",updateDate:"2021-11-19 16:02:35",updateUser:"超级管理员1",tableStatus:null},{id:"32",roleCode:"12",roleName:"433",roleExplain:"223",onOff:"1",updateDate:"2021-11-16 17:04:37",updateUser:"超级管理员1",tableStatus:null},{id:"33",roleCode:"123555",roleName:"2224",roleExplain:"333333",onOff:"1",updateDate:"2021-11-17 11:12:21",updateUser:"超级管理员1",tableStatus:null},{id:"34",roleCode:"2134-00001",roleName:"111",roleExplain:"44",onOff:"1",updateDate:"2021-11-17 11:12:47",updateUser:"超级管理员1",tableStatus:null},{id:"31",roleCode:"234",roleName:"11",roleExplain:"1234",onOff:"1",updateDate:"2021-11-16 17:02:59",updateUser:"超级管理员1",tableStatus:null},{id:"28",roleCode:"3435435",roleName:"3435435",roleExplain:null,onOff:"1",updateDate:"2021-11-08 16:52:47",updateUser:"超级管理员1",tableStatus:null},{id:"22",roleCode:"55555555555",roleName:"55555555555",roleExplain:null,onOff:"1",updateDate:"2021-11-05 15:58:11",updateUser:"超级管理员1",tableStatus:null},{id:"12",roleCode:"666",roleName:"666",roleExplain:null,onOff:"1",updateDate:"2021-10-18 14:51:34",updateUser:"超级管理员1",tableStatus:null},{id:"13",roleCode:"6667",roleName:"6667",roleExplain:"6667",onOff:"0",updateDate:"2021-11-29 13:46:06",updateUser:"超级管理员1",tableStatus:null},{id:"1",roleCode:"ADMINISTRATS",roleName:"超级管理员组",roleExplain:"系统内置，拥有所有模块权限，不可更改删除。",onOff:"1",updateDate:"2023-10-16 16:04:35",updateUser:"超级管理员1",tableStatus:null},{id:"4",roleCode:"CITY_USER_GROUP",roleName:"市级用户组",roleExplain:"市级用户组",onOff:"1",updateDate:"2021-12-14 09:52:51",updateUser:"银川市",tableStatus:null},{id:"16",roleCode:"TEST",roleName:"1",roleExplain:null,onOff:"1",updateDate:"2021-11-02 08:36:31",updateUser:"超级管理员1",tableStatus:null},{id:"2",roleCode:"USER_GROUP",roleName:"普通用户组",roleExplain:"",onOff:"1",updateDate:"2023-05-11 16:23:48",updateUser:"超级管理员1",tableStatus:null},{id:"3",roleCode:"Y_USER_GROUP",roleName:"县级用户组",roleExplain:"",onOff:"1",updateDate:"2020-12-21 15:47:08",updateUser:"超级管理员",tableStatus:null},{id:"37",roleCode:"hanlina",roleName:"韩丽娜测试",roleExplain:"前端测试使用",onOff:"0",updateDate:"2023-08-14 10:11:05",updateUser:"超级管理员1",tableStatus:null},{id:"15",roleCode:"ningxia2021",roleName:"2021交付功能",roleExplain:"2021交付功能",onOff:"1",updateDate:"2021-10-27 10:04:23",updateUser:"超级管理员1",tableStatus:null},{id:"5",roleCode:"test",roleName:"测试角色",roleExplain:"新建测试",onOff:"0",updateDate:"2021-11-05 15:20:14",updateUser:"超级管理员1",tableStatus:null},{id:"36",roleCode:"test-tian1",roleName:"测试tian1",roleExplain:"测试tian1测试tian1测试tian",onOff:"1",updateDate:"2021-11-29 14:50:32",updateUser:"超级管理员1",tableStatus:null},{id:"14",roleCode:"wss_test1022",roleName:"wss_test1022",roleExplain:"wss_test1022",onOff:"0",updateDate:"2021-10-22 14:53:27",updateUser:"超级管理员1",tableStatus:null}];e.forEach((e=>{e.pid=e.supId,e.children&&e.children.forEach((e=>{e.pid=e.supId,e.children&&e.children.forEach((e=>{e.pid=e.supId}))}))})),S=e,q.value=e,G.value=[]})()})),(e,l)=>{const a=t("el-option"),s=t("el-select"),p=t("el-input"),c=t("el-form-item"),f=t("el-radio"),C=t("el-radio-group"),U=t("ss-custom-button"),N=t("el-form"),E=t("ss-condition-area"),_=t("el-button"),x=t("el-table-column"),O=t("el-checkbox"),k=t("ss-table");return d(),h("div",R,[r(E,{onSetConditionFlag:W},{default:o((()=>[n("div",K,[n("div",null,[n("div",M,[A,r(s,{modelValue:m(B).id,"onUpdate:modelValue":l[0]||(l[0]=e=>m(B).id=e),placeholder:"请选择",onChange:de,class:"w_294"},{default:o((()=>[(d(!0),h(v,null,b(P.value,(e=>(d(),u(a,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),r(N,{class:"form",ref_key:"roleform",ref:z,rules:F,"label-width":"110",model:m(B),inline:""},{default:o((()=>[r(c,{label:"角色编码：",required:!0,prop:"roleCode"},{default:o((()=>[r(p,{onKeyup:y(H,["native"]),modelValue:m(B).roleCode,"onUpdate:modelValue":l[1]||(l[1]=e=>m(B).roleCode=e),modelModifiers:{trim:!0},maxlength:"20",class:"w_294"},null,8,["onKeyup","modelValue"])])),_:1}),r(c,{label:"角色名称：",required:!0,prop:"roleName"},{default:o((()=>[r(p,{onKeyup:y(H,["native"]),modelValue:m(B).roleName,"onUpdate:modelValue":l[2]||(l[2]=e=>m(B).roleName=e),modelModifiers:{trim:!0},maxlength:"20",class:"w_294"},null,8,["onKeyup","modelValue"])])),_:1}),r(c,{label:"是否启用：",prop:"onOff"},{default:o((()=>[r(C,{modelValue:m(B).onOff,"onUpdate:modelValue":l[3]||(l[3]=e=>m(B).onOff=e)},{default:o((()=>[r(f,{label:"1"},{default:o((()=>[i("启用")])),_:1}),r(f,{label:"0"},{default:o((()=>[i("停用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),r(c,{label:"角色描述："},{default:o((()=>[r(p,{onKeyup:y(H,["native"]),type:"textarea",modelValue:m(B).roleExplain,"onUpdate:modelValue":l[4]||(l[4]=e=>m(B).roleExplain=e),modelModifiers:{trim:!0},maxlength:"20",class:"w_294"},null,8,["onKeyup","modelValue"])])),_:1}),r(c,{label:" ",style:{"margin-bottom":"0"}},{default:o((()=>[m(B).id?g("",!0):(d(),u(U,{key:0,type:"insert",onClick:X})),m(B).id?(d(),u(U,{key:1,type:"update",onClick:X})):g("",!0),m(B).id?(d(),u(U,{key:2,type:"delete",onClick:Z})):g("",!0),m(B).id?g("",!0):(d(),u(U,{key:3,type:"clear",onClick:te}))])),_:1})])),_:1},8,["rules","model"])]),r(T,{class:"transfer",treeData:q.value,onCallabck:ue,defValue:G.value},null,8,["treeData","defValue"])])])),_:1}),n("div",j,[n("div",Q,[L,n("div",Y,[r(_,{type:"primary",onClick:ee},{default:o((()=>[i("全选")])),_:1}),r(_,{onClick:le,class:"ml_10"},{default:o((()=>[i("取消")])),_:1})])]),r(k,{data:J.value,ref_key:"tabPage",ref:w},{default:o((()=>[r(x,{prop:"code","min-width":"200",label:"模块编码","show-overflow-tooltip":""}),r(x,{prop:"name","min-width":"200",label:"模块名称"}),r(x,{width:"80",label:"添加"},{default:o((({row:e})=>[r(O,{modelValue:e.insert,"onUpdate:modelValue":l=>e.insert=l,disabled:!e.canInsert},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),r(x,{width:"80",label:"修改"},{default:o((({row:e})=>[r(O,{modelValue:e.update,"onUpdate:modelValue":l=>e.update=l,disabled:!e.canUpdate},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),r(x,{width:"80",label:"删除"},{default:o((({row:e})=>[r(O,{modelValue:e.delete,"onUpdate:modelValue":l=>e.delete=l,disabled:!e.canDelete},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),r(x,{width:"80",label:"导出"},{default:o((({row:e})=>[r(O,{modelValue:e.output,"onUpdate:modelValue":l=>e.output=l,disabled:!e.canOutput},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:1}),r(x,{prop:"nouse",width:"150",label:"操作"},{default:o((({row:e})=>[r(_,{onClick:l=>(e=>{e.canInsert&&(e.insert=!0),e.canUpdate&&(e.update=!0),e.canDelete&&(e.delete=!0),e.canOutput&&(e.output=!0)})(e),type:"primary",link:""},{default:o((()=>[i("全选")])),_:2},1032,["onClick"]),r(_,{onClick:l=>(e=>{e.canInsert&&(e.insert=!1),e.canUpdate&&(e.update=!1),e.canDelete&&(e.delete=!1),e.canOutput&&(e.output=!1)})(e),type:"primary",link:""},{default:o((()=>[i("取消")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])])}}},[["__scopeId","data-v-2a6ef776"]]);export{G as default};
