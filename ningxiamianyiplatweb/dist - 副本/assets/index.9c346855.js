var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{s as u,m as r}from"./index.143fdacc.js";import{d as n,s,g as m,q as p,a as c}from"./hr.fbb8980e.js";import{C as v}from"./setting.2fd48f52.js";import{s as b,p as f}from"./regex.fcd5bf03.js";import{r as g,j as h,S as y,b as w,c as k,d as V,w as T,k as D,f as _,e as x,J as I,u as W,I as A,l as C,B as N,A as j,U as M,Y as O,o as B,a0 as $,a1 as U}from"./vendor.cc783c3b.js";const E={slot:"footer",class:"dialog-footer",style:{display:"flex","justify-content":"end"}},S={__name:"dialogInfo",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},areaTreeValue:{type:Object,default:{}},alterData:{type:Object,default:{}}},emits:["fetchData","close"],setup(e,{emit:r}){const p=e,{appContext:c}=O(),B=c.config.globalProperties,$=g("姓名不能包含特殊字符< > & ' \""),U=g({age:"",buildBasecode:p.isEdit?"":p.areaTreeValue.supCode.slice(0,-2),certificate:"",id:"",degree:"",gender:"",immunityWorkingAge:"",name:"",newBasecode:p.isEdit?"":p.areaTreeValue.areaCode.slice(0,-2),positionType:"",post:[],skillTitle:"",validDate:"",workAge:"",unitId:p.alterData.unitId}),S=g(null),P=g(null),Y=g(null),L=g(null),q=g(null),F=g(p.areaTreeValue),G=g(!1),J=h({name:[{required:!0,message:"姓名必填且不能为空！",trigger:"blur"},{pattern:b,message:"姓名不能包含特殊字符< > & ' \"",trigger:"blur"}]});y((()=>p.visible),(e=>{if(e)if(m().then((e=>{200===e.data.code&&(Y.value=e.data.data.occupation,P.value=e.data.data.education,S.value=e.data.data.position,L.value=e.data.data.skillTitle)})),p.isEdit){const e={buildBaseCode:p.alterData.buildBasecode,id:p.alterData.id};n(e).then((e=>{if(200===e.data.code){let a=""!=e.data.data.data.post?e.data.data.data.post.split(",").map((e=>e.trim())):[];U.value={age:e.data.data.data.age,buildBasecode:e.data.data.data.buildBasecode,certificate:e.data.data.data.certificate,id:e.data.data.data.id,degree:e.data.data.data.degree,gender:e.data.data.data.gender,immunityWorkingAge:e.data.data.data.immunityWorkingAge,name:e.data.data.data.name,newBasecode:e.data.data.data.newBasecode,positionType:e.data.data.data.positionType,skillTitle:e.data.data.data.skillTitle,validDate:e.data.data.data.validDate,workAge:e.data.data.data.workAge,post:a,unitId:p.alterData.unitId}}}))}else(()=>{const e={areaId:p.areaTreeValue.id};v(e).then((e=>{200===e.data.code&&(F.value=e.data.data.data)}))})()}),{deep:!0,immediate:!0});const R=()=>{r("fetchData"),r("close",!0)},z=e=>{2==e?(U.value.validDate="",G.value=!0):1==e&&(G.value=!1)},Z=e=>{e.validate((e=>{if(e){let e=U.value.age,r=U.value.post.join(","),n=U.value.workAge,m=U.value.immunityWorkingAge;if(""!=e&&!f.test(e))return B.$util.showMsg("年龄应输入0~150之间的正整数！","error",5e3,!0);if(""!=n&&!f.test(n))return B.$util.showMsg("工龄(全部)应输入0~150之间的正整数！","error",5e3,!0);if(""!=m&&!f.test(m))return B.$util.showMsg("工龄(免疫规划)应输入0~150之间的正整数！","error",5e3,!0);if(Number(n)>Number(e))return B.$util.showMsg("工龄（全部）应小于年龄！","error",5e3,!0);if(Number(m)>Number(e))return B.$util.showMsg("工龄（免疫规划）应小于年龄！","error",5e3,!0);if(Number(m)>Number(n))return B.$util.showMsg("工龄（免疫规划）应小于工龄（全部）！","error",5e3,!0);if("1"==U.value.certificate&&!U.value.validDate)return B.$util.showMsg("证书有效期终止时间必填且不能为空！","error",5e3,!0);const p=(u=((e,a)=>{for(var l in a||(a={}))d.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&i(e,l,a[l]);return e})({},U.value),a(u,l({post:r})));s(p).then((e=>200===e.data.code?(R(),B.$util.showMsg(e.data.data.data||"修改成功！","success",5e3,!0)):B.$util.showMsg(e.data.data.data||"修改失败！","error",5e3,!0)))}var u}))};return(a,l)=>{const t=w("el-input"),d=w("el-form-item"),o=w("el-option"),i=w("el-select"),r=w("el-checkbox"),n=w("el-checkbox-group"),s=w("el-date-picker"),m=w("el-form"),c=w("el-button"),v=w("el-dialog");return k(),V(v,{title:p.isEdit?"编辑":"新增",modelValue:e.visible,"onUpdate:modelValue":l[12]||(l[12]=e=>M(visible)?visible.value=e:null),width:"1000","before-close":R,"close-on-click-modal":!1,class:"customDialog","append-to-body":!0,style:{"max-height":"700px","overflow-y":"auto"}},{default:T((()=>[D(m,{ref_key:"ruleFormRef",ref:q,rules:J,model:U.value,"label-width":"120px"},{default:T((()=>[p.isEdit?_("",!0):(k(),V(d,{key:0,label:"地区",prop:"areaName","label-width":"200"},{default:T((()=>[D(t,{value:F.value.supCode.slice(0,-2)+" "+F.value.supAreaName,readonly:"",disabled:""},null,8,["value"])])),_:1})),p.isEdit?_("",!0):(k(),V(d,{key:1,label:"接种单位",prop:"unitName","label-width":"200"},{default:T((()=>[D(t,{value:F.value.areaCode.slice(0,-2)+" "+F.value.areaName,readonly:"",disabled:""},null,8,["value"])])),_:1})),D(d,{label:"姓名",prop:"name","label-width":"200"},{default:T((()=>[D(t,{modelValue:U.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value.name=e),clearable:""},null,8,["modelValue"])])),_:1}),D(d,{label:"性别","label-width":"200"},{default:T((()=>[D(i,{modelValue:U.value.gender,"onUpdate:modelValue":l[1]||(l[1]=e=>U.value.gender=e),clearable:""},{default:T((()=>[(k(!0),x(A,null,I(W(B).$commonOptions.genderSelect,(e=>(k(),V(o,{label:e.name,value:e.id,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"年龄",prop:"age","label-width":"200"},{default:T((()=>[D(t,{modelValue:U.value.age,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value.age=e),maxlength:"3",min:"1",max:"150"},null,8,["modelValue"])])),_:1}),D(d,{label:"专/兼职",prop:"positionType","label-width":"200"},{default:T((()=>[D(i,{modelValue:U.value.positionType,"onUpdate:modelValue":l[3]||(l[3]=e=>U.value.positionType=e),clearable:""},{default:T((()=>[(k(!0),x(A,null,I(W(B).$commonOptions.positionTypeSelect,(e=>(k(),V(o,{label:e.name,value:e.id,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"从事岗位",prop:"post","label-width":"200"},{default:T((()=>[D(n,{modelValue:U.value.post,"onUpdate:modelValue":l[4]||(l[4]=e=>U.value.post=e)},{default:T((()=>[(k(!0),x(A,null,I(S.value,(e=>(k(),V(r,{label:e.code,key:e.code},{default:T((()=>[C(N(e.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"工龄（全部）",prop:"workAge","label-width":"200"},{default:T((()=>[D(t,{modelValue:U.value.workAge,"onUpdate:modelValue":l[5]||(l[5]=e=>U.value.workAge=e),maxlength:"3",min:"1",max:"150"},null,8,["modelValue"])])),_:1}),D(d,{label:"工龄（免疫规划）",prop:"immunityWorkingAge","label-width":"200"},{default:T((()=>[D(t,{modelValue:U.value.immunityWorkingAge,"onUpdate:modelValue":l[6]||(l[6]=e=>U.value.immunityWorkingAge=e),maxlength:"3",min:"1",max:"150"},null,8,["modelValue"])])),_:1}),D(d,{label:"技术职称",prop:"skillTitle","label-width":"200"},{default:T((()=>[D(i,{modelValue:U.value.skillTitle,"onUpdate:modelValue":l[7]||(l[7]=e=>U.value.skillTitle=e)},{default:T((()=>[(k(!0),x(A,null,I(L.value,(e=>(k(),V(o,{label:e.name,value:e.code,key:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"学历",prop:"degree","label-width":"200"},{default:T((()=>[D(i,{modelValue:U.value.degree,"onUpdate:modelValue":l[8]||(l[8]=e=>U.value.degree=e)},{default:T((()=>[(k(!0),x(A,null,I(P.value,(e=>(k(),V(o,{label:e.name,value:e.code,key:e.code},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"培训证有无",prop:"certificate","label-width":"200"},{default:T((()=>[D(i,{modelValue:U.value.certificate,"onUpdate:modelValue":l[9]||(l[9]=e=>U.value.certificate=e),onChange:z},{default:T((()=>[(k(!0),x(A,null,I(W(B).$commonOptions.certiFicate,(e=>(k(),V(o,{label:e.name,value:e.id,key:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),D(d,{label:"培训合格有效期至",prop:"validDate","label-width":"200"},{default:T((()=>[D(s,{modelValue:U.value.validDate,"onUpdate:modelValue":l[10]||(l[10]=e=>U.value.validDate=e),readonly:G.value,disabled:G.value,type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"234px"}},null,8,["modelValue","readonly","disabled"])])),_:1})])),_:1},8,["rules","model"]),j("span",E,[D(c,{onClick:R},{default:T((()=>[C("取 消")])),_:1}),D(c,{type:"primary",onClick:l[11]||(l[11]=e=>Z(q.value))},{default:T((()=>[C("保 存")])),_:1})]),D(d,{"label-width":"200",class:"dialog-footer"},{default:T((()=>[D(u,{remarkText:$.value},null,8,["remarkText"])])),_:1})])),_:1},8,["title","modelValue"])}}},P={class:"condition-row"},Y={class:"item"},L=j("span",{class:"required label"},"单位选择：",-1),q={__name:"index",setup(e){const a=r(),{appContext:l}=O(),t=l.config.globalProperties,d=g([]),o=g(0),i=g(1),u=g(0),n=g(!1),s=g(!1),m=g({}),v=g({}),b=g([{label:"序号",type:"index"},{label:"操作",type:"operation",minWidth:"150",btns:[{event:"delete",type:"danger",text:"删除"},{event:"alter",text:"修改"}]},{label:"所属地区",prop:"areaName",minWidth:"120",overflowTip:!0},{label:"所属接种单位",prop:"unitName",minWidth:"150",overflowTip:!0},{label:"人员编码",prop:"personId",minWidth:"140"},{label:"姓名",prop:"name",minWidth:"100",overflowTip:!0},{label:"性别",prop:"gender",minWidth:"60"},{label:"年龄",prop:"age",minWidth:"60"},{label:"专/兼职",prop:"positionType",minWidth:"80"},{label:"从事岗位",prop:"post",minWidth:"140",overflowTip:!0},{label:"工龄（全部）",prop:"workAge",minWidth:"120"},{label:"工龄（免疫规划）",prop:"immunityWorkingAge",minWidth:"150"},{label:"技术职称",prop:"skillTitle",minWidth:"110"},{label:"学历",prop:"degree",minWidth:"140",overflowTip:!0},{label:"培训证有无",prop:"certificate",minWidth:"120"},{label:"培训合格有效期至",prop:"validDate",minWidth:"160"},{label:"维护日期",prop:"maintenanceDate",minWidth:"160"}]);let f=h({supCode:a.userInfo.areaCode,areaId:a.userInfo.areaId,id:a.userInfo.areaId,areaCode:a.userInfo.areaCode,areaName:a.userInfo.areaName,selectAreaLevel:sessionStorage.getItem("currentLevel")});const y=e=>{f=e,v.value.id=e.id,v.value=e};B((()=>{const e=JSON.parse(sessionStorage.getItem("roleModules")).filter((e=>4648==e.moduleId))[0];"1"==e.delete||"1"==e.update||(b.value=b.value.filter((e=>"operation"!=e.type)))}));const I=e=>{"number"==typeof e&&(i.value=e);const a={areaCode:f.areaCode,areaId:f.areaId,areaLevel:f.selectAreaLevel,areaName:f.areaName,pageNum:i.value,pageSize:t.$consts.PAGE_SIZE,moduleId:sessionStorage.getItem("moduleId")};p(a).then((e=>{200===e.data.code&&(e.data.data.list.map((e=>{e.validDate=e.validDate?/\d{4}-\d{1,2}-\d{1,2}/g.exec(e.validDate)[0]:"",e.maintenanceDate=e.maintenanceDate?/\d{4}-\d{1,2}-\d{1,2}/g.exec(e.maintenanceDate)[0]:""})),d.value=e.data.data.list,o.value=e.data.data.total)}))},A=()=>{if("4"!=f.selectAreaLevel)return t.$util.showMsg("请选择接种单位！","error");v.value=f,s.value=!1,$((()=>{n.value=!0}))},C=()=>{n.value=!1},N=(e,a)=>{var l;"alter"==a&&(l=e,m.value=l,s.value=!0,$((()=>{n.value=!0}))),"delete"==a&&(e=>{U.confirm("确定删除吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",draggable:!0}).then((()=>{const a={buildBaseCode:e.buildBasecode,id:e.id};c(a).then((e=>{if(200===e.data.code)return I(),t.$util.showMsg("删除成功！","success")}))})).catch((()=>{}))})(e)};return(e,a)=>{const l=w("ss-area-areaTreeStation"),t=w("ss-custom-button"),i=w("ss-query-bottom"),r=w("ss-condition-area"),p=w("ss-custom-table");return k(),x("div",null,[D(r,null,{default:T((()=>[j("div",P,[j("div",Y,[L,D(l,{modelValue:W(f),"onUpdate:modelValue":a[0]||(a[0]=e=>M(f)?f.value=e:f=e),getToLevelNum:5,onNodeClick:y},null,8,["modelValue"])])]),D(i,{secTime:u.value},{default:T((()=>[D(t,{type:"insert",onClick:A}),D(t,{type:"query",onClick:I})])),_:1},8,["secTime"])])),_:1}),D(p,{tableData:d.value,columnList:b.value,total:o.value,onRowOperateFun:N,onGoPage:I},null,8,["tableData","columnList","total"]),n.value?(k(),V(S,{key:0,visible:n.value,onClose:C,areaTreeValue:v.value,alterData:m.value,isEdit:s.value,onFetchData:I},null,8,["visible","areaTreeValue","alterData","isEdit"])):_("",!0)])}}};export{q as default};
