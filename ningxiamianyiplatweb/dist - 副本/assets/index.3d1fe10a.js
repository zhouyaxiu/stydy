import{h as e,j as a,k as l,l as o,m as t,n as d}from"./setting.2fd48f52.js";import{a as r}from"./area.ee098c38.js";import{_ as i,m as n,P as s}from"./index.143fdacc.js";import{m as u}from"./md5.de100709.js";import{r as m,j as p,S as c,b as g,x as v,c as b,d as f,w as h,y as w,e as V,k,A as y,u as T,f as C,U as _,l as D,I as N,J as I,Y as U,a0 as A,n as E,B as P,a1 as x}from"./vendor.cc783c3b.js";const Y={class:"replace-add inoculationUnit_editForm",style:{margin:"-20px 0"}},L={style:{"margin-left":"-30px"},class:"w_50"},M={class:"w_50"},S={class:"dialog-footer"};var $=i({__name:"editForm",props:{isEdit:{type:Boolean,default:!1},editVisible:{type:Boolean,default:!1},curId:{type:String,default:""}},emits:["closeDialog"],setup(o,{emit:t}){const d=o,i=n(),{appContext:s}=U(),P=s.config.globalProperties,x={commName:[{required:!0,message:"上级地区项只能选择乡镇（街道）",trigger:"change"}],organCode:[{required:!0,trigger:"blur",validator:(e,a,l)=>{d.isEdit||a>0&&a<99&&/^[0-9]{2}$/.test(a)?l():l(new Error("范围从01-98，且必须为两位数，同一乡镇下不能重复"))}}],organName:[{required:!0,trigger:"blur",validator:(e,a,l)=>{/^[\u4e00-\u9fa5a-zA-Z0-9]+$/.test(a)?l():l(new Error("不可输入特殊字符，同一乡镇下不能相同"))}}],beginDate:[{required:!0,message:"启用日期项为必选项，请填写完整再保存！",trigger:"blur"}],endDate:[{required:!0,message:"停用日期项为必选项，请填写完整再保存！",trigger:"blur"}],buildArea:[{required:!0,trigger:"blur",validator:(e,a,l)=>{/^(?!0+(?:\.0+)?$)(?:[1-9]\d*|0)(?:\.\d{1,2})?$/.test(a)?a<=9999999999.99?l():l(new Error("请输入不大于9999999999.99的正数")):l(new Error("请输入正整数或保留两位小数的正数"))}}],longitude:[{required:!1,trigger:"blur",validator:(e,a,l)=>{a&&!/^[\-\+]?(0?\d{1,2}(\.\d{1,6})*|1[0-7]?\d{1}(\.\d{1,6})*|180(\.0{1,6})*)$/.test(a)?l(new Error("-180.0～+180.0，最多保留6位小数，或输入整数")):l()}}],dimension:[{required:!1,trigger:"blur",validator:(e,a,l)=>{a&&!/^[\-\+]?([0-8]?\d{1}(\.\d{1,6})*|90(\.0{1,6})*)$/.test(a)?l(new Error("-90.0～+90.0，最多保留6位小数位，或输入整数")):l()}}],linkPhone:[{required:!1,trigger:"blur",validator:(e,a,l)=>{!a||/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/.test(a)||/^0\d{2,3}-\d{7,8}|\(?0\d{2,3}[)-]?\d{7,8}|\(?0\d{2,3}[)-]*\d{7,8}/.test(a)||l(new Error("电话号格式不正确")),l()}}],newBaseCode:[{required:!0,pattern:/^\d{10}$/,message:"客户端识别码必须为10位数字，请填写完整再保存！",trigger:"blur"}],passWord:[{required:!0,message:"上传密码项为必选项，请填写完整再保存！",trigger:"blur"}],serviceType:[{required:!0,message:"服务类型项为必选项，请填写完整再保存！",trigger:"change"}],workType:[{required:!0,message:"工作类型项为必选项，请填写完整再保存！",trigger:"change"}]},$=m(null),O=m(!1);let B=m({passWord:"",supId:i.userInfo.areaId,supCode:i.userInfo.areaCode,supAreaLevel:i.currentLevel,organCode:"",organName:"",organAddress:"",linkPhone:"",linkMan:"",clinicDate:"",beginDate:P.$dateUtil.currentDate(),endDate:P.$dateUtil.getAfterNYearsDateStr(10),newBaseCode:"",buildArea:"",clinicType:"",serviceType:"",workType:"",longitude:"",dimension:"",businessType:"",checksetting:!0});const q=e=>{let a=(Number(B.value.beginDate.substr(0,4))+10).toString()+B.value.beginDate.substr(4,10);return e.getTime()>new Date(a).getTime()},W=e=>{let a=(Number(B.value.endDate.substr(0,4))-10).toString()+B.value.endDate.substr(4,10);return e.getTime()<new Date(a).getTime()||e.getTime()>new Date(B.value.endDate).getTime()};let J=p({areaId:i.userInfo.areaId,areaCode:i.userInfo.areaCode,selectAreaLevel:i.currentLevel}),j=p({});c((()=>d.editVisible),(e=>{e&&(d.isEdit?A((()=>{R()})):A((()=>{B.value.checksetting=!0})))}),{deep:!0,immediate:!0});const F=e=>{"3"!==e.selectAreaLevel?(J.areaId=e.id,A((()=>{J.areaId=i.userInfo.areaId})),E.error("只能选择乡镇")):(J=e,B.value.commName=e.areaName,B.value.supId=e.id,B.value.supCode=e.areaCode,B.value.supAreaLevel=e.selectAreaLevel)},z=(e,a)=>{let l=new Date(B.value.beginDate),o=new Date(B.value.endDate);o.getTime()-l.getTime()>3155328e5&&(E.error("启用日期与停用日期不能大于10年"),B.value.endDate=""),l.getTime()>o.getTime()&&(E.error("启用日期不能大于停用日期"),B.value.endDate="")},R=()=>{O.value=!0,e({organCode:d.curId}).then((e=>{O.value=!1,j=JSON.parse(JSON.stringify(e.data.data.data))||{},B.value={supId:j.supId,supCode:j.supCode,commName:j.supName,organCode:j.organCode||"",organName:j.organName||"",organAddress:j.organAddress||"",linkPhone:j.linkPhone||"",linkMan:j.linkMan||"",clinicDate:j.clinicDay||"",beginDate:j.beginDate||"",endDate:j.endDate||"",buildArea:j.buildingArea||"",newBaseCode:j.newBaseCode||"",checksetting:H(j,"mark"),dimension:j.dimension||"",longitude:j.longitude||"",passWord:j.password||"",clinicType:j.clinicType?P.$commonOptions.clinicTypeList.filter((e=>e.name==j.clinicType))[0].code:"",serviceType:j.serviceType?P.$commonOptions.fwTypeList.filter((e=>e.name==j.serviceType))[0].code:"",workType:j.workType?P.$commonOptions.workTypeList.filter((e=>e.name==j.workType))[0].code:""}})).catch((()=>{O.value=!1}))},H=(e,a)=>null===e[a]?"":"1"===e[a],Q=e=>{$.value.resetFields(),j={},t("closeDialog",e)},Z=()=>{d.isEdit||"3"===B.value.supAreaLevel||E.error("上级地区项只能选择乡镇（街道）"),B.value.cModID=i.moduleId,$.value.validate((e=>{if(e)if(d.isEdit){const e=JSON.parse(JSON.stringify(B.value));delete e.checksetting,delete e.commName,e.mark=B.value.checksetting?"1":"0",e.id=j.id,e.passWord=j.password===B.value.passWord?j.password:u(B.value.passWord),e.operateType=P.$consts.OPTYPE_UPDATE,O.value=!0,a(e).then((e=>{O.value=!1,200===e.data.code?(E({message:e.data.data.data,type:"success"}),r(),Q(!0)):E.error(e.data.popMsg)})).catch((()=>{O.value=!1}))}else{const e=JSON.parse(JSON.stringify(B.value));delete e.checksetting,e.mark=B.value.checksetting?"1":"0",e.passWord=u(B.value.passWord),e.operateType=P.$consts.OPTYPE_INSERT,O.value=!0,l(e).then((e=>{O.value=!1,200===e.data.code?(r(),E.success(e.data.data.data),Q(!0)):E.error(e.data.popMsg)})).catch((()=>{O.value=!1}))}}))};return(e,a)=>{const l=g("el-input"),t=g("el-form-item"),d=g("ss-area-areaTreeStation"),r=g("el-date-picker"),n=g("el-option"),s=g("el-select"),u=g("el-checkbox"),m=g("el-form"),p=g("el-button"),c=g("el-dialog"),U=v("loading");return b(),f(c,{title:o.isEdit?"修改":"新增",modelValue:o.editVisible,"onUpdate:modelValue":a[22]||(a[22]=e=>_(editVisible)?editVisible.value=e:null),width:"55%","before-close":Q},{default:h((()=>[w((b(),V("div",Y,[k(m,{ref_key:"ruleForm",ref:$,rules:x,"label-width":"150px",model:T(B)},{default:h((()=>[y("div",L,[o.isEdit?(b(),f(t,{key:0,label:"上级地区编码：",prop:"supCode"},{default:h((()=>[k(l,{modelValue:T(B).supCode,"onUpdate:modelValue":a[0]||(a[0]=e=>T(B).supCode=e),disabled:!0},null,8,["modelValue"])])),_:1})):C("",!0),o.isEdit?(b(),f(t,{key:1,label:"上级地区名称：",prop:"commName"},{default:h((()=>[k(l,{modelValue:T(B).commName,"onUpdate:modelValue":a[1]||(a[1]=e=>T(B).commName=e),disabled:!0},null,8,["modelValue"])])),_:1})):C("",!0),o.isEdit?C("",!0):(b(),f(t,{key:2,label:"上级地区名称：",prop:"commName"},{default:h((()=>[k(d,{defTreeValue:T(J).areaId,modelValue:T(J),"onUpdate:modelValue":a[2]||(a[2]=e=>_(J)?J.value=e:J=e),getToLevelNum:4-T(i).currentLevel,onNodeClick:F},null,8,["defTreeValue","modelValue","getToLevelNum"])])),_:1})),k(t,{label:"接种单位编码：",prop:"organCode"},{default:h((()=>[k(l,{modelValue:T(B).organCode,"onUpdate:modelValue":a[3]||(a[3]=e=>T(B).organCode=e),disabled:o.isEdit},null,8,["modelValue","disabled"])])),_:1}),k(t,{label:"接种单位名称：",prop:"organName"},{default:h((()=>[k(l,{modelValue:T(B).organName,"onUpdate:modelValue":a[4]||(a[4]=e=>T(B).organName=e)},null,8,["modelValue"])])),_:1}),k(t,{label:"地址：",prop:"organAddress"},{default:h((()=>[k(l,{modelValue:T(B).organAddress,"onUpdate:modelValue":a[5]||(a[5]=e=>T(B).organAddress=e),maxlength:"50"},null,8,["modelValue"])])),_:1}),k(t,{label:"电话：",prop:"linkPhone"},{default:h((()=>[k(l,{modelValue:T(B).linkPhone,"onUpdate:modelValue":a[6]||(a[6]=e=>T(B).linkPhone=e),maxlength:"20"},null,8,["modelValue"])])),_:1}),k(t,{label:"联系人：",prop:"linkMan"},{default:h((()=>[k(l,{modelValue:T(B).linkMan,"onUpdate:modelValue":a[7]||(a[7]=e=>T(B).linkMan=e),maxlength:"30"},null,8,["modelValue"])])),_:1}),k(t,{label:"门诊日：",prop:"clinicDate"},{default:h((()=>[k(l,{modelValue:T(B).clinicDate,"onUpdate:modelValue":a[8]||(a[8]=e=>T(B).clinicDate=e),maxlength:"20"},null,8,["modelValue"])])),_:1}),k(t,{label:"启用日期：",prop:"beginDate"},{default:h((()=>[k(r,{modelValue:T(B).beginDate,"onUpdate:modelValue":a[9]||(a[9]=e=>T(B).beginDate=e),"disabled-date":W,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:a[10]||(a[10]=e=>z())},null,8,["modelValue"])])),_:1}),k(t,{label:"停用日期：",prop:"endDate"},{default:h((()=>[k(r,{modelValue:T(B).endDate,"onUpdate:modelValue":a[11]||(a[11]=e=>T(B).endDate=e),"disabled-date":q,onChange:a[12]||(a[12]=e=>z()),clearable:!1,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1})]),y("div",M,[k(t,{label:"客户端识别码：",prop:"newBaseCode"},{default:h((()=>[k(l,{modelValue:T(B).newBaseCode,"onUpdate:modelValue":a[13]||(a[13]=e=>T(B).newBaseCode=e),disabled:o.isEdit},null,8,["modelValue","disabled"])])),_:1}),k(t,{label:"上传密码：",prop:"passWord",class:"edit_formcheck_setting"},{default:h((()=>[k(l,{modelValue:T(B).passWord,"onUpdate:modelValue":a[14]||(a[14]=e=>T(B).passWord=e),type:"password","show-password":""},null,8,["modelValue"])])),_:1}),k(t,{label:"建筑面积：",prop:"buildArea"},{default:h((()=>[k(l,{modelValue:T(B).buildArea,"onUpdate:modelValue":a[15]||(a[15]=e=>T(B).buildArea=e)},{append:h((()=>[D("m²")])),_:1},8,["modelValue"])])),_:1}),k(t,{label:"地图坐标：",prop:"longitude"},{default:h((()=>[k(l,{modelValue:T(B).longitude,"onUpdate:modelValue":a[16]||(a[16]=e=>T(B).longitude=e)},{prepend:h((()=>[D("经度")])),_:1},8,["modelValue"])])),_:1}),k(t,{label:"",prop:"dimension"},{default:h((()=>[k(l,{modelValue:T(B).dimension,"onUpdate:modelValue":a[17]||(a[17]=e=>T(B).dimension=e)},{prepend:h((()=>[D("纬度")])),_:1},8,["modelValue"])])),_:1}),k(t,{label:"服务周期：",prop:"clinicType"},{default:h((()=>[k(s,{modelValue:T(B).clinicType,"onUpdate:modelValue":a[18]||(a[18]=e=>T(B).clinicType=e),clearable:"",filterable:"",style:{width:"100%"}},{default:h((()=>[(b(!0),V(N,null,I(T(P).$commonOptions.clinicTypeList,(e=>(b(),f(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(t,{label:"服务类型：",prop:"serviceType"},{default:h((()=>[k(s,{modelValue:T(B).serviceType,"onUpdate:modelValue":a[19]||(a[19]=e=>T(B).serviceType=e),clearable:"",filterable:"",style:{width:"100%"}},{default:h((()=>[(b(!0),V(N,null,I(T(P).$commonOptions.fwTypeList,(e=>(b(),f(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(t,{label:"工作类型：",prop:"workType"},{default:h((()=>[k(s,{modelValue:T(B).workType,"onUpdate:modelValue":a[20]||(a[20]=e=>T(B).workType=e),clearable:"",style:{width:"100%"}},{default:h((()=>[(b(!0),V(N,null,I(T(P).$commonOptions.workTypeList,(e=>(b(),f(n,{key:e.code,value:e.code,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),k(t,{prop:"checksetting",class:"edit_formcheck_setting"},{default:h((()=>[k(u,{modelValue:T(B).checksetting,"onUpdate:modelValue":a[21]||(a[21]=e=>T(B).checksetting=e)},{default:h((()=>[D("是否允许上传")])),_:1},8,["modelValue"])])),_:1})])])),_:1},8,["model"])])),[[U,O.value]]),y("span",S,[k(p,{onClick:Q},{default:h((()=>[D("取 消")])),_:1}),k(p,{type:"primary",onClick:Z},{default:h((()=>[D("确 定")])),_:1})])])),_:1},8,["title","modelValue"])}}},[["__scopeId","data-v-2aabf6a5"]]);const O={class:"condition-row"},B={class:"item"},q=y("span",{class:"label required"},"上级行政区划：",-1),W={class:"item"},J={class:"item"},j={class:"condition-row"},F={__name:"index",setup(e){const a=n(),{appContext:l}=U(),i=l.config.globalProperties;let u=p({areaId:a.userInfo.areaId,areaCode:a.userInfo.areaCode,newBaseCode:a.userInfo.areaCode.substr(0,10),areaName:a.userInfo.areaName,selectAreaLevel:a.currentLevel});const v=m(0),f=m(!1),w=m(!1),C=m(!1),N=m(!1),I=m(!1),A=m(null),Y=p({unitnameCheck:"",childNo:""}),L=m(s),M=m(!1),S=m(0),F=m(1),z=m([]),R=m("");c((()=>C.value),(e=>{e||(Y.unitnameCheck="")}),{deep:!0,immediate:!0}),c((()=>N.value),(e=>{e||(Y.childNo="")}),{deep:!0,immediate:!0});const H=e=>{u=e},Q=e=>{if(e||(e=1),C.value&&""===Y.unitnameCheck)return E.error("请输入接种单位名称"),!1;if(N.value&&""===Y.childNo)return E.error("请输入客户端识别码"),!1;F.value=e;const l={supCode:u.areaCode,supAreaLevel:u.selectAreaLevel,supAreaName:u.areaName+" "+u.newBaseCode,organName:Y.unitnameCheck,newBasecode:Y.childNo,pageNum:e,operateType:i.$consts.OPTYPE_QUERY,cModId:a.moduleId};A.value=l,o(l).then((e=>{z.value=e.data.data.data.list,S.value=e.data.data.data.total,v.value=e.data.data.sec})).catch((()=>{}))},Z=(e,a)=>{f.value=e,e&&(R.value=a),I.value=!0},G=e=>{R.value=null,!0===e&&(Q(),setTimeout((()=>{w.value=!0}),500)),I.value=!1},K=()=>{A.value?0!=z.value.length?M.value=!0:E.error("暂无需要导出的数据！"):E.error("查询后才可以导出！")},X=()=>{M.value=!1},ee=()=>{let e=JSON.parse(JSON.stringify(A.value));e.selectAreaName=e.selectAreaName+e.newBaseCode,e.operateType=i.$consts.OPTYPE_OUTPUT,t(e)};return(e,l)=>{const o=g("ss-area-areaTreeStation"),t=g("el-checkbox"),n=g("el-input"),s=g("ss-custom-button"),m=g("ss-explain-tip-text"),p=g("ss-condition-area"),c=g("ss-pagination"),U=g("el-table-column"),A=g("el-button"),ae=g("ss-table"),le=g("ss-export-dialog");return b(),V("div",null,[k(p,{ref:"conditionPage"},{default:h((()=>[y("div",O,[y("div",B,[q,k(o,{showSelect:!1,getToLevelNum:4,modelValue:T(u),"onUpdate:modelValue":l[0]||(l[0]=e=>_(u)?u.value=e:u=e),reload:w.value,onNodeClick:H},null,8,["modelValue","reload"])]),y("div",W,[k(t,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value=e),label:!0,class:"label"},{default:h((()=>[D("接种单位名称：")])),_:1},8,["modelValue"]),k(n,{disabled:!C.value,clearable:"",modelValue:Y.unitnameCheck,"onUpdate:modelValue":l[2]||(l[2]=e=>Y.unitnameCheck=e),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])]),y("div",J,[k(t,{modelValue:N.value,"onUpdate:modelValue":l[3]||(l[3]=e=>N.value=e),label:!0,class:"label"},{default:h((()=>[D("客户端识别码：")])),_:1},8,["modelValue"]),k(n,{disabled:!N.value,clearable:"",modelValue:Y.childNo,"onUpdate:modelValue":l[4]||(l[4]=e=>Y.childNo=e),modelModifiers:{trim:!0}},null,8,["disabled","modelValue"])])]),y("div",j,[k(s,{type:"insert",onClick:l[5]||(l[5]=e=>Z(!1,""))}),k(s,{type:"query",onClick:l[6]||(l[6]=e=>Q(1))}),k(s,{type:"output",onClick:K}),k(m,{secTime:v.value,showSecTimeFlag:!0},null,8,["secTime"])])])),_:1},512),k(c,{onPageChange:Q,pageSize:L.value,pageIndex:F.value,total:S.value},null,8,["pageSize","pageIndex","total"]),k(ae,{data:z.value,ref:"tabPage",transfer:!0,headerCellStyle:{"text-align":"center"},cellStyle:{"text-align":"center"}},{default:h((()=>[k(U,{type:"index","min-width":"60",label:"序号",fixed:""},{default:h((e=>[D(P(20*(F.value-1)+e.$index+1),1)])),_:1}),k(U,{"min-width":"120px",label:"操作"},{default:h((({row:e})=>[k(A,{onClick:a=>Z(!0,e.organCode),link:"",type:"primary"},{default:h((()=>[D("修改")])),_:2},1032,["onClick"]),k(A,{onClick:l=>{return o=e.id,void x.confirm("请确认是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((()=>{d({id:o,operateType:i.$consts.OPTYPE_DELETE,cModID:a.moduleId}).then((e=>{200===e.data.code?(r(),setTimeout((()=>{w.value=!0}),500),E.success(e.data.data.data)):E.error(e.data.popMsg),Q()}))})).catch((()=>{E.info("已取消删除")}));var o},link:"",type:"primary"},{default:h((()=>[D("删除")])),_:2},1032,["onClick"])])),_:1}),k(U,{prop:"supName","min-width":"140",label:"上级地区","show-overflow-tooltip":""}),k(U,{prop:"organCode","min-width":"140",label:"接种单位编码","show-overflow-tooltip":""}),k(U,{prop:"organName","min-width":"180",label:"接种单位名称","show-overflow-tooltip":""}),k(U,{prop:"organAddress","min-width":"200",label:"地址","show-overflow-tooltip":""}),k(U,{prop:"linkPhone","min-width":"140",label:"电话","show-overflow-tooltip":""},{default:h((({row:e})=>[D(P(e.linkPhone?e.linkPhone.substring(0,e.linkPhone.length-4)+"****":""),1)])),_:1}),k(U,{prop:"linkMan","min-width":"100",label:"联系人"}),k(U,{prop:"clinicDay","min-width":"80",label:"门诊日"}),k(U,{prop:"beginDate","min-width":"110",label:"启用日期"}),k(U,{prop:"endDate","min-width":"110",label:"停用日期"}),k(U,{prop:"newBaseCode","min-width":"130",label:"客户端识别码","show-overflow-tooltip":""}),k(U,{"min-width":"120",label:"是否允许上传"},{default:h((({row:e})=>[D(P("1"===e.mark?"是":"否"),1)])),_:1}),k(U,{prop:"serviceType","min-width":"100",label:"服务类型"}),k(U,{prop:"clinicType","min-width":"90",label:"服务周期"}),k(U,{prop:"workType","min-width":"140",label:"工作类型"}),k(U,{prop:"buildingArea","min-width":"110",label:"建筑总面积"}),k(U,{prop:"","min-width":"420",label:"地图坐标","show-overflow-tooltip":""},{default:h((({row:e})=>[D(P(e.longitude?"经度："+e.longitude:"")+" "+P(e.dimension?"；纬度："+e.dimension:""),1)])),_:1})])),_:1},8,["data"]),k($,{editVisible:I.value,isEdit:f.value,curId:R.value,onCloseDialog:G},null,8,["editVisible","isEdit","curId"]),k(le,{onCallback:ee,onHandleClose:X,total:S.value,typeStr:"接种单位管理",dialogVisible:M.value},null,8,["total","dialogVisible"])])}}};export{F as default};
