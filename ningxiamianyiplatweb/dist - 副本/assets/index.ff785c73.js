var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,u=(e,a)=>{for(var l in a||(a={}))d.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))i.call(a,l)&&o(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{g as n,a as s,b as c,c as v,e as m}from"./setting.2fd48f52.js";import{m as p}from"./index.143fdacc.js";import{r as f,j as b,S as g,b as D,c as h,d as y,w as I,A as V,k as w,u as _,U as k,l as U,Y as C,n as x,e as T,I as j,J as E,B as M,a1 as N}from"./vendor.cc783c3b.js";const Y={class:"dialog-footer"},O={__name:"noticeManageDialog",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},curId:{type:[Number,String],default:null}},emits:["fetchData","close"],setup(e,{emit:a}){const l=e,t=p(),{appContext:d}=C(),i=d.config.globalProperties,o=f(null),v=f(""),m=f([]),T=f(!1),j=f("");let E=b({areaId:""}),M=f({valid:!0,validDate:[]});const N={title:{required:!0,message:"请输入",trigger:"blur"},detail:{required:!0,message:"请输入",trigger:"blur"},areaRange:[{required:!0,validator:(e,a,l)=>{l()}}]};g((()=>l.visible),(e=>{e&&(l.isEdit?n({id:l.curId}).then((e=>{M.value=e.data.data,T.value=null===M.value.validDate,M.value.valid="1"===M.value.valid,E.areaId=M.value.distName,m.value=M.value.distId,v.value=M.value.validDate})):(M.value.valid=!0,M.value.validDate=i.$dateUtil.currentDate()))}),{deep:!0,immediate:!0}),g((()=>T.value),(e=>{e?M.value.validDate=null:l.isEdit?null===v.value?M.value.validDate=i.$dateUtil.currentDate():M.value.validDate=v.value:M.value.validDate=i.$dateUtil.currentDate()}),{deep:!0,immediate:!0});const O=e=>{M.value.areaRange=e,m.value=e.join()},P=e=>{E=e,m.value=e.id},q=()=>{if(!m.value.length)return x.error("请选择发布范围"),!1;const e=r(u({},M.value),{cModId:t.moduleId,distId:m.value,valid:!0===M.value.valid?"1":"0",fbUser:t.userInfo.id,fbDistId:t.userInfo.areaId,fbdw:t.userInfo.areaName+" "+t.userInfo.areaCode});o.value.validate((t=>{t&&(l.isEdit?s(r(u({},e),{id:l.curId})).then((e=>{x.success(e.data.msg),a("fetchData"),S()})).catch((()=>{S()})):c(e).then((e=>{x.success(e.data.msg),a("fetchData"),S()})).catch((()=>{S()})))}))},S=()=>{o.value.resetFields(),a("close")};return(a,l)=>{const t=D("el-input"),d=D("el-form-item"),i=D("ss-area-areaTreeStation"),u=D("el-date-picker"),r=D("el-checkbox"),n=D("el-form"),s=D("el-button"),c=D("el-dialog");return h(),y(c,{title:e.isEdit?"修改":"新增",modelValue:e.visible,"onUpdate:modelValue":l[6]||(l[6]=e=>k(visible)?visible.value=e:null),width:"38%","before-close":S,"close-on-click-modal":!1,class:"noticeManageFormDialog"},{default:I((()=>[V("div",null,[w(n,{"label-width":"180px",model:_(M),ref_key:"unitFormRef",ref:o,rules:N},{default:I((()=>[w(d,{label:"标题:",prop:"title"},{default:I((()=>[w(t,{modelValue:_(M).title,"onUpdate:modelValue":l[0]||(l[0]=e=>_(M).title=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),w(d,{label:"发布范围:",prop:"areaRange"},{default:I((()=>[!e.isEdit&&e.visible?(h(),y(i,{key:0,defTreeValue:j.value,getToLevelNum:3,multiple:!0,onCheckClick:O},null,8,["defTreeValue"])):(h(),y(i,{key:1,getToLevelNum:3,defTreeValue:_(E).areaId,modelValue:_(E),"onUpdate:modelValue":l[1]||(l[1]=e=>k(E)?E.value=e:E=e),onNodeClick:P},null,8,["defTreeValue","modelValue"]))])),_:1}),w(d,{label:"有效期限:",prop:"validDate"},{default:I((()=>[w(u,{style:{width:"100%"},clearable:!1,disabled:null===_(M).validDate,modelValue:_(M).validDate,"onUpdate:modelValue":l[2]||(l[2]=e=>_(M).validDate=e),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["disabled","modelValue"])])),_:1}),w(d,null,{default:I((()=>[w(r,{modelValue:T.value,"onUpdate:modelValue":l[3]||(l[3]=e=>T.value=e)},{default:I((()=>[U("永久有效")])),_:1},8,["modelValue"]),w(r,{modelValue:_(M).valid,"onUpdate:modelValue":l[4]||(l[4]=e=>_(M).valid=e)},{default:I((()=>[U("保留该信息")])),_:1},8,["modelValue"])])),_:1}),w(d,{label:"详细内容:",prop:"detail"},{default:I((()=>[w(t,{rows:5,type:"textarea",clearable:"",maxlength:"1000","show-word-limit":"",modelValue:_(M).detail,"onUpdate:modelValue":l[5]||(l[5]=e=>_(M).detail=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])]),V("span",Y,[w(s,{onClick:S},{default:I((()=>[U("取消")])),_:1}),w(s,{type:"primary",onClick:q},{default:I((()=>[U("保存")])),_:1})])])),_:1},8,["title","modelValue"])}}},P={class:"condition-row"},q={class:"item required"},S={class:"item"},$=V("div",{class:"label required"},"发布范围：",-1),B={class:"item"},L=V("div",{class:"label required"},"排列方式：",-1),R={class:"condition-row"},F={key:0},A={key:1},z={__name:"index",setup(e){const a=p(),{appContext:l}=C(),t=l.config.globalProperties,d=f(!1),i=f(!1),o=f(null),u=f([]),r=f(1),n=f(0),s=f(20),c=[{id:"0",name:"按时间排列"},{id:"1",name:"按发布范围排列"},{id:"2",name:"按标题排列"}];let g=b({areaId:a.userInfo.areaId,areaCode:a.userInfo.areaCode,selectAreaLevel:a.currentLevel});const y=b({orderType:"0",complaintDate:[t.$dateUtil.currentDate(),t.$dateUtil.currentDate()],pageNum:1}),Y=e=>{"number"==typeof e&&(r.value=e),z()},z=()=>{y.startDate=y.complaintDate[0],y.endDate=y.complaintDate[1],y.selectAreaId=g.areaId,y.userId=a.userInfo.id,y.pageNum=r.value,y.operateType=t.$consts.OPTYPE_QUERY,y.cModId=a.moduleId,v(y).then((e=>{u.value=e.data.data.list,n.value=e.data.data.total})).catch((()=>{}))},J=e=>{g=e},Q=()=>{d.value=!0},G=()=>{d.value=!1,i.value=!1,o.value=null};return(e,l)=>{const t=D("ss-date-range"),v=D("ss-area-areaTreeStation"),p=D("el-option"),f=D("el-select"),b=D("ss-custom-button"),C=D("ss-condition-area"),H=D("ss-pagination"),K=D("el-table-column"),W=D("el-button"),X=D("ss-table");return h(),T("div",null,[w(C,null,{default:I((()=>[V("div",P,[V("div",q,[w(t,{title:"发布时间",defaultValue:y.complaintDate,"onUpdate:defaultValue":l[0]||(l[0]=e=>y.complaintDate=e)},null,8,["defaultValue"])]),V("div",S,[$,w(v,{getToLevelNum:3,modelValue:_(g),"onUpdate:modelValue":l[1]||(l[1]=e=>k(g)?g.value=e:g=e),onNodeClick:J},null,8,["modelValue"])]),V("div",B,[L,w(f,{modelValue:y.orderType,"onUpdate:modelValue":l[2]||(l[2]=e=>y.orderType=e),placeholder:"请选择"},{default:I((()=>[(h(),T(j,null,E(c,(e=>w(p,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])]),V("div",R,[w(b,{type:"insert",onClick:Q}),w(b,{type:"query",onClick:Y})])])),_:1}),w(H,{total:n.value,pageIndex:r.value,pageSize:s.value,onPageChange:Y},null,8,["total","pageIndex","pageSize"]),w(X,{data:u.value},{default:I((()=>[w(K,{type:"index","min-width":"80",label:"序号",fixed:""},{default:I((e=>[U(M(20*(r.value-1)+e.$index+1),1)])),_:1}),w(K,{prop:"title","min-width":"200",label:"标题","show-overflow-tooltip":""}),w(K,{prop:"fbDate","min-width":"160",label:"发布时间"}),w(K,{prop:"fbUser","min-width":"180",label:"发布者"}),w(K,{prop:"fbdw","min-width":"200",label:"发布者单位"}),w(K,{prop:"distName","min-width":"160",label:"发布范围"}),w(K,{prop:"validDate","min-width":"180",label:"有效期限"},{default:I((({row:e})=>[U(M(e.validDate?e.validDate.slice(0,10):"永久有效"),1)])),_:1}),w(K,{prop:"valid","min-width":"120",label:"是否保留"},{default:I((({row:e})=>["1"===e.valid?(h(),T("span",F,"是")):(h(),T("span",A,"否"))])),_:1}),w(K,{"min-width":"160px",label:"操作"},{default:I((({row:e})=>[w(W,{disabled:!e.canUpdate,onClick:a=>(e=>{d.value=!0,o.value=e.id,i.value=!0})(e),link:"",type:"primary"},{default:I((()=>[U("修改")])),_:2},1032,["disabled","onClick"]),w(W,{disabled:!e.canDelete,onClick:l=>(e=>{N.confirm("请确认是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then((()=>{m({id:e.id,cModId:a.moduleId}).then((e=>{x.success("删除成功!"),Y()}))})).catch((()=>{x.info("已取消删除")}))})(e),link:"",type:"primary"},{default:I((()=>[U("删除")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"]),w(O,{visible:d.value,onClose:G,onFetchData:z,isEdit:i.value,curId:o.value},null,8,["visible","isEdit","curId"])])}}};export{z as default};
